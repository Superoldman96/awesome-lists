rule Exploit_MacOS_WeightBufs_A_2147913716_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:MacOS/WeightBufs.A!MTB"
        threat_id = "2147913716"
        type = "Exploit"
        platform = "MacOS: "
        family = "WeightBufs"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {a8 83 5f f8 e9 0f 40 f9 00 09 09 8b f4 06 00 94 e0 17 00 b9 e8 17 40 b9 e9 17 40 f9 ea 0f 40 f9 28 79 2a b8 01 00 00 14}  //weight: 1, accuracy: High
        $x_1_2 = {ff c3 01 d1 fd 7b 06 a9 fd 83 01 91 48 00 00 90 08 65 40 f9 08 01 40 f9 a8 83 1f f8 a0 83 1d f8 e1 1b 00 f9 e2 17 00 f9 e8 17 40 f9 e8 03 00 f9 08 05 00 f1 e8 17 9f 1a 88 01 00 37 01 00 00 14}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_MacOS_WeightBufs_C_2147934904_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:MacOS/WeightBufs.C!MTB"
        threat_id = "2147934904"
        type = "Exploit"
        platform = "MacOS: "
        family = "WeightBufs"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "4"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "weightBufs.m" ascii //weight: 1
        $x_1_2 = "INCREASE MAX_SHMEMS BY 0x1000 THEN RUN THE EXPLOIT AGAIN" ascii //weight: 1
        $x_1_3 = "_hwx_patch_model" ascii //weight: 1
        $x_1_4 = "Stage 1: Grooming kernel memory" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_MacOS_WeightBufs_B_2147935641_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:MacOS/WeightBufs.B!MTB"
        threat_id = "2147935641"
        type = "Exploit"
        platform = "MacOS: "
        family = "WeightBufs"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_MACHOHSTR_EXT"
        threshold = "5"
        strings_accuracy = "High"
    strings:
        $x_1_1 = "com.opa334.weightBufs" ascii //weight: 1
        $x_1_2 = "groom_kernel_map" ascii //weight: 1
        $x_1_3 = "hwx_patch_model" ascii //weight: 1
        $x_1_4 = "_lookup_scratched_shmem" ascii //weight: 1
        $x_1_5 = "/weightBufs.framework/weightBufs" ascii //weight: 1
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

