rule Exploit_Linux_CVE_2017_17215_A_2147766385_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/CVE-2017-17215.A!MTB"
        threat_id = "2147766385"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "CVE-2017-17215"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = {68 6f 73 74 3d 60 62 75 73 79 62 6f 78 2b 77 67 65 74 2b [0-4] 3a 2f 2f [0-3] 2e [0-3] 2e [0-3] 2e [0-3] 2f [0-21] 2f 2b 2d 4f 2b 2f 74 6d 70 2f 67 61 66 3b 73 68 2b 2f 74 6d 70 2f 67 61 66}  //weight: 1, accuracy: Low
        $x_1_2 = {2f 73 68 65 6c 6c 3f 63 64 2b 2f 74 6d 70 3b 72 6d 2b 2d 72 66 2b 2a 3b 77 67 65 74 2b 20 [0-3] 2e [0-3] 2e [0-3] 2e [0-3] 2f 6a 61 77 73 3b 73 68 2b 2f 74 6d 70 2f 6a 61 77 73}  //weight: 1, accuracy: Low
        $x_1_3 = {72 65 6d 6f 74 65 5f 68 6f 73 74 3d 25 33 62 63 64 2b 2f 74 6d 70 3b 77 67 65 74 2b [0-4] 3a 2f 2f [0-3] 2e [0-3] 2e [0-3] 2e [0-3] 2f [0-21] 2f 6e 37 3b 63 68 6d 6f 64 2b 37 37 37 2b 6e 37 3b 2e 2f 6e 37 3b 72 6d 2b 2d 72 66 2b 6e 37 25 33 62 25 32 33 26 72 65 6d 6f 74 65 53 75 62 6d 69 74 3d 53 61 76 65}  //weight: 1, accuracy: Low
        $x_1_4 = {62 75 73 79 62 6f 78 20 77 67 65 74 20 2d 67 20 [0-3] 2e [0-3] 2e [0-3] 2e [0-3] 20 2d 6c 20 2f 74 6d 70 2f 62 69 67 48 20 2d 72 20 2f [0-21] 2f 3b 63 68 6d 6f 64 20 37 37 37 20 2f 74 6d 70 2f 62 69 67 48 3b 2f 74 6d 70 2f 62 69 67 48 20 68 75 61 77 65 69 2e 72 65 70 2e 6d 69 70 73 3b 72 6d 20 2d 72 66 20 2f 74 6d 70 2f 62 69 67 48}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (2 of ($x*))
}

rule Exploit_Linux_CVE_2017_17215_B_2147766386_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/CVE-2017-17215.B!MTB"
        threat_id = "2147766386"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "CVE-2017-17215"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {80 1f 00 28 2f 80 00 00 41 [0-5] 81 3f 00 30 80 09 00 0c 81 3f 00 28 90 09 00 0c 81 3f 00 2c a0 09 00 00 54 00 04 3e 81 3f 00 28 b0 09 00 10 80 7f 00 28 48 00 07 9d}  //weight: 2, accuracy: Low
        $x_2_2 = {38 00 00 05 90 1f 00 14 80 1f 00 64 1c 00 05 18 7c 0b 03 78 3d 20 10 03 80 09 ea 84 7c 0b 02 14 90 1f 00 54 81 3f 00 54 80 09 00 08 2f 80 00 00 [0-5] 3d 20 10 03 81 69 ea 80 81 3f 00 54 80 09 00 04 7d 20 58 50 80 1f 00 14 7f 89 00 40 [0-5] 81 3f 00 54 80 09 00 00 7c 03 03 78}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (1 of ($x*))
}

rule Exploit_Linux_CVE_2017_17215_B_2147766386_1
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/CVE-2017-17215.B!MTB"
        threat_id = "2147766386"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "CVE-2017-17215"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "3"
        strings_accuracy = "Low"
    strings:
        $x_1_1 = "exploitscanner_setup_connection" ascii //weight: 1
        $x_1_2 = "attack_listfork" ascii //weight: 1
        $x_1_3 = "attack_udp" ascii //weight: 1
        $x_1_4 = {2f 62 69 6e 2f 62 75 73 79 62 6f 78 20 77 67 65 74 20 2d 67 20 25 73 20 2d 6c 20 2f 74 6d 70 2f 2e [0-16] 20 2d 72 20 2f 6d 69 70 73 3b 20 2f 62 69 6e 2f 62 75 73 79 62 6f 78 20 63 68 6d 6f 64 20 2b 78 20 2f 74 6d 70 2f 2e [0-16] 3b 20 2f 74 6d 70 2f 2e [0-16] 20 68 75 61 77 65 69 2e 6d 69 70 73}  //weight: 1, accuracy: Low
    condition:
        (filesize < 20MB) and
        (3 of ($x*))
}

rule Exploit_Linux_CVE_2017_17215_2147819612_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/CVE-2017-17215!MTB"
        threat_id = "2147819612"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "CVE-2017-17215"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "Low"
    strings:
        $x_2_1 = {83 c4 10 89 c2 80 ce 08 8b 45 08 8b 00 83 ec 04 52 6a 04 50 e8 [0-5] 83 c4 10 66 c7 ?? ?? 02 00 8b 45 08 8b 40 0c 89 45 f4 8b 45 08 8b 40 10 66 89 ?? ?? a1 e8 [0-5] 89 c2 8b 45 08 89 50 04}  //weight: 2, accuracy: Low
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Linux_CVE_2017_17215_C_2147821040_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/CVE-2017-17215.C!MTB"
        threat_id = "2147821040"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "CVE-2017-17215"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "3"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {a0 af b1 07 9c af b0 07 98 03 a0 f0 21 af bc 00 18 af c0 00 7c}  //weight: 1, accuracy: High
        $x_1_2 = {8c 43 00 00 00 00 10 21 27 c5 01 a0 af a2 00 10 af a0 00 14 00 60 20 21 24 06 05 ea 24 07 40 00}  //weight: 1, accuracy: High
        $x_1_3 = {40 20 21 00 80 10 21 00 02 10 c0 00 02 18 80 00 43 10 21 00 44 10 21 00 02 10 80 00 44 10 23 00 02 10 c0 00 40 18 21}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

rule Exploit_Linux_CVE_2017_17215_D_2147936162_0
{
    meta:
        author = "defender2yara"
        detection_name = "Exploit:Linux/CVE-2017-17215.D!MTB"
        threat_id = "2147936162"
        type = "Exploit"
        platform = "Linux: Linux platform"
        family = "CVE-2017-17215"
        severity = "Critical"
        info = "MTB: Microsoft Threat Behavior"
        signature_type = "SIGNATURE_TYPE_ELFHSTR_EXT"
        threshold = "2"
        strings_accuracy = "High"
    strings:
        $x_1_1 = {00 16 02 70 01 00 2c bf 8c 22 ff 8f e0 7c f1 c0 fc 1c 48 b3 cf 75 01 00 2c bf 40 7a fc 15 02 92 8c 22 ff 8f fb f5 04 14 1f 30 00 c5 e0 7f a2 c0}  //weight: 1, accuracy: High
        $x_1_2 = {e8 13 02 b0 48 71 0a 70 7e 0f 00 00 08 72 48 77 89 e7 c7 f6 d8 13 02 b0 42 22 82 0e 5f 67 ef 7a 42 25 4d 10 30 e2 4f 7a 40 ad e8 13 02 b0 48 71 0a 70 52 0f 00 00 08 72 1a 72}  //weight: 1, accuracy: High
    condition:
        (filesize < 20MB) and
        (all of ($x*))
}

